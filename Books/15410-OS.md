# Operating System

## Stack
* x86-64 = EMT64 = AMD64
* + [difference-between-EMT64-AMD64](https://superuser.com/questions/383711/whats-the-difference-between-intel-64-and-amd64)
* stack
* + pushl / popl
```
save register (caller saved: %eax/%edx/%ecx/r8/r9/r10/r11/conditional flags)
arguments
return addr (added by call)
old ebp
saved register (callee saved: %ebx/%esi/%edi/r12/r13/r14/r15/%ebp/%esp)
local variables
```
* [special-registers-xs](https://reverseengineering.stackexchange.com/questions/2006/how-are-the-segment-registers-fs-gs-cs-ss-ds-es-used-in-linux)

## Execution
* Exception
* [CPU-Int-Table](https://wiki.osdev.org/Exceptions)
* trap (int 3 / OxCC): ++EIP
> Traps are reported immediately after the execution of the trapping instruction. A trap is an exception that is reported immediately following the execution of the trapping instruction. Traps allow execution of a program or task to be continued without loss of program continuity. The return address for the trap handler points to the instruction to be executed after the trapping instruction.
* + [Windows-consider-INT3-single-byte-and-decrement-EIP-by-1](http://www.triplefault.io/2017/08/detecting-debuggers-by-abusing-bad.html)
* fault: EIP sames
> These can be corrected and the program may continue as if nothing happened. A fault is an exception that can generally be corrected and that, once corrected, allows the program to be restarted with no loss of continuity. When a fault is reported, the processor restores the machine state to the state prior to the beginning of execution of the faulting instruction. The return address (saved contents of the CS and EIP registers) for the fault handler points to the faulting instruction, rather than to the instruction following the faulting instruction.
* abort
> Some severe unrecoverable error.
* interrupt (programmable, syscall 0x80)
> Interrupts occur at random times during the execution of a program, in response to signals from hardware. System hardware uses interrupts to handle events external to the processor, such as requests to service peripheral devices. Software can also generate interrupts by executing the INT n instruction.
```
Kernel stack:
    Register status (pushal)
    EFLAGS
    CS
    EIP
    Error Code
Call Handler
IRET
```
* + interrupt masking
* + non-maskable interrupt